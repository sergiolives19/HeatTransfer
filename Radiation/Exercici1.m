epsilon = [0.8,0.8,0.8,1]';
T=[0,0,0,0]';
T(1) = 1073;
T(4) = 296;
E = [0,0,0,0]';
E(1) = PoderEmissiu(epsilon(1),T(1));
E(4) = PoderEmissiu(epsilon(4),T(4));
sigma = 5.67*10^-8;
ro=zeros(4,1);
A = [0.03817, 0.006362, 0.01272, 0.006362]';
for i=1:4
    ro(i) = 1 - epsilon(i);
end
F = [[0.6972,0.1514,0.09701,0.05437];[0.9083,0,0.03594,0.05573];
    [0.2910,0.01797,0.3820,0.3090];[0.3262,0.05573,0.6180,0.0000]];
fluxQ = [0,0,0,0]';
fluxQ(2) = 0;
fluxQ(3) = 0;
% for i=1:4
%     if T(i) ~= 'n'
%         J(i) = ro(i)*(J(1)*F(i,1)+J(2)*F(i,2)+J(3)*F(i,3)+J(4)*F(i,4))+epsilon(i)*sigma*T(i)^4;
%     else
%         fluxQ(i)=J(1)*F(i,1)+J(2)*F(i,2)+J(3)*F(i,3)+J(4)*F(i,4)-J(i);
%     end       
% end
% J(1) = ro(1)*(J(1)*F(1,1)+J(2)*F(1,2)+J(3)*F(1,3)+J(4)*F(1,4))+E(1);
% J(4) = ro(4)*(J(1)*F(4,1)+J(2)*F(4,2)+J(3)*F(4,3)+J(4)*F(4,4))+E(4);
% fluxQ(2)=J(1)*F(2,1)-J(2)+J(2)*F(2,2)-J(2)+J(3)*F(2,3)-J(2)+J(4)*F(2,4)-J(2);
% fluxQ(3)=J(1)*F(3,1)-J(3)+J(2)*F(3,2)-J(3)+J(3)*F(3,3)-J(3)+J(4)*F(3,4)-J(3);

% J(1)*(ro(1)*F(1,1)-1)+J(2)*ro(1)*F(1,2)+J(3)*ro(1)*F(1,3)+J(4)*ro(1)*F(1,4) = -epsilon(1)*sigma*T(1)^4;
% F(2, 1)*J(1) + (F(2, 2)-1)*J(2) + F(2, 3)*J(3) + F(2, 4)*J(4) = fluxQ(2);
% F(3, 1)*J(1) + F(3, 2)*J(2) + (F(3, 3)-1)*J(3) + F(3, 4)*J(4) = fluxQ(3);
% J(1)*ro(4)*F(4,1)+J(2)*F(4,2)+J(3)*ro(4)*F(4,3)+J(4)*(ro(4)*F(4,4)-1)= -epsilon(4)*sigma*T(4)^4;

MatriuCoef = [[ro(1)*F(1,1)-1, ro(1)*F(1,2), ro(1)*F(1,3), ro(1)*F(1,4)];
    [F(2,1), F(2,2)-1, F(2,3), F(2,4)];
    [F(3,1), F(3,2), F(3,3)-1, F(3,4)];
    [ro(4)*F(4,1), ro(4)*F(4,2), ro(4)*F(4,3), ro(4)*F(4,4)-1]];
b = [-E(1), fluxQ(2), fluxQ(3),-E(4)]';
J = inv(MatriuCoef)*b;

G = zeros(4,1);
% G(i) = J(1)*F(i,1)+J(2)*F(i,2)+J(3)*F(i,3)+J(4)*F(i,4);
G(1) = J(1)*F(1,1)+J(2)*F(1,2)+J(3)*F(1,3)+J(4)*F(1,4);
G(2) = J(1)*F(2,1)+J(2)*F(2,2)+J(3)*F(2,3)+J(4)*F(2,4);
G(3) = J(1)*F(3,1)+J(2)*F(3,2)+J(3)*F(3,3)+J(4)*F(3,4);
G(4) = J(1)*F(4,1)+J(2)*F(4,2)+J(3)*F(4,3)+J(4)*F(4,4);
q = zeros(4,1);
for i=1:4
    fluxQ(i) = G(i)-J(i);
    E(i) = J(i) - ro(i)*G(i);
    T(i) = (E(i)/(sigma*epsilon(i)))^(1/4);
    q(i) = fluxQ(i)*A(i);
end